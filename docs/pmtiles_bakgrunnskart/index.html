<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>PMTiles Light Grey Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
    
    <script src="https://unpkg.com/pmtiles/dist/pmtiles.js"></script>
    <script src="../common-header.js"></script>
    
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }

        /* Inspect feature popup styles */
        .inspect-popup {
            position: absolute;
            pointer-events: none;
            background: rgba(30,30,30,0.95);
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            font-size: 14px;
            z-index: 9999;
            max-width: 320px;
            white-space: pre-wrap;
            border: 1px solid #00ffff;
            display: none;
            overflow-y: hidden;
        }
        .demo-info {
            position: relative;
            background: #222;
            color: #fff;
            padding: 16px 32px;
            z-index: 10000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        }
        .demo-info h2 {
            margin: 0 0 8px 0;
            font-size: 1.5em;
        }
        .demo-info p {
            margin: 0;
            font-size: 1em;
        }
    </style>
</head>
<body>

<div class="demo-info">
    <h2>PMTiles Demo p√• bakgrunnskart uten servere (N5000-datasett)</h2>
    <p>Interaktivt bakgrunnskart som benytter en enkelt cloud native PMTiles-fil for vector tiles med alle kartdata. Utforsk kartet og inspiser objekter med musen.</p>
</div>

<div id="map"></div>
<div id="inspect-popup" class="inspect-popup"></div>

<script>
    // 1. Initialize the PMTiles protocol
    let protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.tile);

    
    // 2. Initialize the MapLibre map using style.json
    const map = new maplibregl.Map({
        container: "map",
        style: "style_n5000_positron.json",
        // set explicit center
        center: [8.861573681786354, 61.87774254585082],
        zoom: 5.631333431788067
    });


    // Add navigation controls
    map.addControl(new maplibregl.NavigationControl());
    // --- Inspect Feature Popup ---
    const popup = document.getElementById('inspect-popup');

    map.on('mousemove', (e) => {
        const features = map.queryRenderedFeatures(e.point);
        if (features.length > 0) {
            let props = '';
            features.forEach((feature, idx) => {
                props += `<div style='margin-bottom:8px;'>`;
                props += `<b>Layer:</b> ${feature.layer.id}<br/>`;
                for (const key in feature.properties) {
                    props += `<b>${key}</b>: ${feature.properties[key]}<br/>`;
                }
                props += `</div>`;
            });
            popup.innerHTML = props;
            popup.style.display = 'block';
            popup.style.left = (e.originalEvent.clientX + 15) + 'px';
            popup.style.top = (e.originalEvent.clientY + 15) + 'px';
        } else {
            popup.style.display = 'none';
        }
    });

    map.on('mouseout', () => {
        popup.style.display = 'none';
    });

</script>

</body>
</html>